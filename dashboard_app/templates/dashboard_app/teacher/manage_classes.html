{% extends "dashboard_app/base_dashboard.html" %}

{% block title %}Manage Classes | Cattendance{% endblock %}

{% block content %}
<div class="p-8 max-w-[1500px] mx-auto">
  <!-- Header -->
  <div class="justify-between mb-6 flex items-center">
    <div>
      <h1 class="text-3xl font-bold text-gray-800 mb-2">Manage Classes</h1>
      <p>View and manage all your classes</p>
    </div>
    <button
      id="openAddClassModal"
      class="bg-gradient-to-r font-semibold from-[#a2314b] to-[#d64648] text-white px-4 py-2 rounded-lg hover:bg-[#892728] transition flex items-center"
    >
      <i class="fa-solid fa-plus mr-2"></i>Add Class
    </button>
  </div>

  <!-- Classes Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    {% for cls in classes %}
    <div class="border border-gray-300 rounded-2xl bg-white p-5 mt-6">
      <div class="flex justify-between items-center mb-4">
        <div class="flex gap-4 items-center">
          <div class="w-12 h-12 bg-[#f0f0f0] rounded flex items-center justify-center font-bold">
            {{ cls.code|slice:":3" }}
          </div>
          <div class="flex flex-col space-y-1">
            <h2 class="text-xl font-semibold text-gray-700">{{ cls.code }}</h2>
            <p>{{ cls.title }}</p>
          </div>
        </div>
        <div class="text-gray-600 transition gap-4 flex">
          <button class="hover:text-[#a2314b] text-[20px]">
            <i class="fa-regular fa-trash"></i>
          </button>
          <button class="hover:text-[#a2314b] text-[20px]">
            <i class="fa-solid fa-pen-to-square"></i>
          </button>
        </div>
      </div>
      <p class="text-gray-600 mb-4">
        <i class="fa-regular fa-clock"></i> {{ cls.schedule_days }} - {{ cls.schedule_time }}
      </p>
      <p class="text-gray-600 mb-2">
        <i class="fa-regular fa-users pr-2"></i>{{ cls.student_count }} Students
      </p>
      <hr class="my-4">
      <button class="bg-[#a2314b] w-full text-center font-semibold justify-center text-white px-4 py-2 rounded-lg hover:bg-[#892728] transition flex items-center">
        <i class="fa-solid fa-magnifying-glass pr-2"></i>View Class
      </button>
    </div>
    {% empty %}
    <p class="text-gray-500">No classes available.</p>
    {% endfor %}
  </div>
</div>

<!-- MODAL: Add Class -->
<div id="addClassModal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center hidden z-50">
  <div class="bg-white rounded-xl shadow-lg w-full max-w-md p-6 relative">
    <button id="closeAddClassModal" class="absolute top-3 right-3 text-gray-500 hover:text-[#a2314b]">
      <i class="fa-solid fa-xmark text-xl"></i>
    </button>
    <h2 class="text-2xl font-bold text-gray-800 mb-4">Add New Class</h2>

    <form method="POST" action="{% url 'dashboard_teacher:add_class' %}" class="space-y-4">
      {% csrf_token %}
      <div>
        <label class="block text-gray-700 font-semibold mb-1">Class Code</label>
        <input type="text" name="code" required class="w-full border border-gray-300 p-2 rounded focus:ring-2 focus:ring-[#a2314b]">
      </div>
      <div>
        <label class="block text-gray-700 font-semibold mb-1">Class Title</label>
        <input type="text" name="title" required class="w-full border border-gray-300 p-2 rounded focus:ring-2 focus:ring-[#a2314b]">
      </div>
      <div>
        <label class="block text-gray-700 font-semibold mb-1">Schedule Days</label>
        <input type="text" name="schedule_days" placeholder="e.g. MWF" required class="w-full border border-gray-300 p-2 rounded focus:ring-2 focus:ring-[#a2314b]">
      </div>
      <div>
        <label class="block text-gray-700 font-semibold mb-1">Schedule Time</label>
        <input type="text" name="schedule_time" placeholder="e.g. 8:00AM - 10:00AM" required class="w-full border border-gray-300 p-2 rounded focus:ring-2 focus:ring-[#a2314b]">
      </div>

      <div class="pt-2">
        <button type="submit" class="bg-gradient-to-r from-[#a2314b] to-[#d64648] text-white px-4 py-2 rounded-lg font-semibold w-full hover:bg-[#892728] transition">
          Add Class
        </button>
      </div>
    </form>
  </div>
</div>

<!-- JS for Modal -->
<script>
  const modal = document.getElementById("addClassModal");
  const openBtn = document.getElementById("openAddClassModal");
  const closeBtn = document.getElementById("closeAddClassModal");

  openBtn.addEventListener("click", () => modal.classList.remove("hidden"));
  closeBtn.addEventListener("click", () => modal.classList.add("hidden"));
  modal.addEventListener("click", (e) => {
    if (e.target === modal) modal.classList.add("hidden");
  });
</script>
{% endblock %}
